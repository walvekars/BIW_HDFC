<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_new_picklist">
        <t t-call="web.html_container">
            <div class="header">
                <img t-if="docs.sel_hand_off.company_id.logo"
                     t-att-src="'data:image/png;base64,%s' % to_text(docs.sel_hand_off.company_id.logo)" height="80px"
                     width="80px"/>
            </div>

            <table style="width:100%; border: 1pt solid black; border-right:0pt; border-left:0pt;">
                <tr>
                    <td>
                        <span>
                            <b>Date:</b>
                        </span>
                        <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%m/%d/%Y %H:%M:%S')"/>
                        <br/>
                        <span>
                            <b>User:</b>
                        </span>
                        <t t-esc="docs.log_user"/>
                        <br/>
                        <span>
                            <b>Courier Company:</b>
                        </span>
                        <t t-esc="docs.sel_hand_off.courier_company_id.name"/>
                    </td>
                </tr>
            </table>

            <table style="width:100%; border: 1pt solid black; border-right:0pt; border-left:0pt;">
                <tr>
                    <td style="width:40%">
                        <span>
                            <b>Client Name:</b>
                        </span>
                        <t t-if="docs.sel_hand_off.unique_ref.try_no_type == '0'">
                            <t t-esc="docs.sel_hand_off.unique_ref.customer_name.parent_id.name"/>
                        </t>
                        <t t-else="docs.sel_hand_off.unique_ref.try_no_type != '0'">
                            <t t-esc="docs.sel_hand_off.unique_ref.parent_line.customer_name.parent_id.name"/>
                        </t>
                        <br/>
                        <span>
                            <b>Hand-off ID:</b>
                        </span>
                        <t t-esc="docs.sel_hand_off.hand_off_id"/>
                        <br/>
                        <span>
                            <b>Hand-off Date Time:</b>
                        </span>
                        <t t-esc="docs.date" t-options="{'widget': 'date', 'format': 'MM/dd/yyyy'}"/>
                    </td>
                    <td style="width:30%">
                        <span>
                            <b>Courier Name:</b>
                        </span>
                        <t t-esc="docs.sel_hand_off.courier_company_id.name"/>
                        <br/>
                        <span>
                            <b>Courier Acc No:</b>
                        </span>
                        <t t-esc="docs.sel_hand_off.courier_company_id.courier_account_number"/>
                        <br/>
                        <br/>
                    </td>
                    <td style="width:40%">
                        <span>
                            <b>Generated By:</b>
                        </span>
                        <t t-esc="docs.log_user"/>
                        <br/>
                        <span>
                            <b>Vehicle:</b>
                        </span>
                        <br/>
                        <span>
                            <b>Driver:</b>
                        </span>
                    </td>
                </tr>
            </table>

            <br/>

            <t t-set="quant_list" t-value="[]"/>
            <table style="width:100%; border: 1pt solid black; border-collapse:collapse">
                <thead>
                    <th style="border:1pt solid black; font-size:17px;">Sl No.</th>
                    <th style="border:1pt solid black; font-size:17px;">Order No</th>
                    <th style="border:1pt solid black; font-size:17px;">Product Code</th>
                    <th style="border:1pt solid black; font-size:17px;">Quantity</th>
                    <th style="border:1pt solid black; font-size:17px;">Airway Bill No.</th>
                    <th style="border:1pt solid black; font-size:17px;">Box Code</th>
                </thead>
                <body>
                    <t t-set="i" t-value="1"/>
                    <t t-foreach="docs.env['stock.picking'].search([])" t-as="s">
                        <t t-if="docs.date and docs.sel_hand_off and s.hand_off_date_time and s.hand_off_id">
                            <t t-if="docs.date == s.hand_off_date_time.date() and docs.sel_hand_off.hand_off_id == s.hand_off_id and s.picking_type_code == 'outgoing'">
                                <tr>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="i"/>
                                        <t t-set="i" t-value="i+1"/>
                                    </td>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="s.unique_ref.ref_no"/>
                                    </td>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="s.unique_ref.global_item_code.default_code"/>
                                    </td>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="round(s.unique_ref.qty)"/>
                                        <t t-set="quant_list"
                                           t-value="quant_list + [s.unique_ref.qty]"/>
                                    </td>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="s.awb_number.awb_number"/>
                                    </td>
                                    <td style="border:1pt solid black; font-size:18px; text-align:center">
                                        <t t-esc="s.unique_ref.global_item_code.packing_material"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </t>
                </body>
            </table>
            <hr/>
            <div style="text-align:left; padding-left:52%;">
                <b>Total:</b>
                <t t-esc="round(sum(quant_list))"/>
            </div>
            <hr/>
            <hr/>
            <br/>
            <div style="text-align:center;">End of Report</div>
        </t>
    </template>


    <record id="handoff_file_report" model="ir.actions.report">
        <field name="name">Courier Hand-off</field>
        <field name="model">handoff.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">multiple_order_process.report_new_picklist</field>
        <field name="report_file">multiple_order_process.report_new_picklist</field>
        <field name="binding_type">report</field>
    </record>

    <record id="hand_off_courier_file_report" model="ir.ui.view">
        <field name="name">Courier Hand-off</field>
        <field name="model">handoff.wizard</field>
        <field name="arch" type="xml">
            <form>
                <group>
                    <group>
                        <field name="date" string="Date"/>
                    </group>
                    <group>
                        <field name="sel_hand_off" context="{'hand_off_id': True}"
                               options="{'no_create': True, 'no_create_edit':True}"/>
                    </group>
                </group>
                <footer>
                    <button string="Generate File" type="object" name="generate_courier_handoff" class="btn btn-primary"/>
                    <button name="courier_hand_off_printing" type="object" string="Print To printer" class="oe_highlight"/>
                    <button string="Cancel" special="cancel" class="btn btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_courier_handover_file_Wizard">
        <field name="name">Courier Hand-off</field>
        <field name="res_model">handoff.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <menuitem id="hand_over_courier_menu"
              name="Courier Hand Off"
              parent="stock.menu_warehouse_report"
              action="action_courier_handover_file_Wizard"
              sequence="201"/>

</odoo>
